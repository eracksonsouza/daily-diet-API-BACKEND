# Daily Diet API - TODO List

## ‚úÖ Feito

### Infraestrutura
- [x] Configurar Fastify
- [x] Configurar Knex com SQLite
- [x] Criar migra√ß√£o para tabela de usu√°rios
- [x] Criar migra√ß√£o para tabela de refei√ß√µes
- [x] Configurar TypeScript
- [x] Configurar scripts de desenvolvimento
- [x] Instalar Zod para valida√ß√£o
- [x] Criar estrutura de rotas (src/routes/diet.ts)
- [x] Registrar rotas no servidor

### Modelo de Dados
- [x] Tabela users com (id, name, email, session_id, created_at)
- [x] Tabela meals com (id, user_id, name, description, date_time, is_on_diet, created_at)
- [x] Relacionamento entre users e meals (CASCADE)

## üìã Requisitos Funcionais (RF)

### Usu√°rios
- [x] RF01: Criar um novo usu√°rio (POST /users)
  - [x] Validar dados de entrada (nome, email)
  - [x] Gerar UUID √∫nico
  - [x] Gerar session_id para cookies
  - [x] Retornar dados do usu√°rio criado

- [x] RF02: Identificar usu√°rio entre requisi√ß√µes
  - [x] Implementar middleware de autentica√ß√£o via cookies
  - [x] Validar session_id em cada requisi√ß√£o protegida
  - [x] Retornar erro 401 se n√£o autenticado

### Refei√ß√µes
- [x] RF03: Registrar uma refei√ß√£o (POST /meals)
  - [x] Validar dados: nome, descri√ß√£o, data/hora, is_on_diet
  - [x] Associar refei√ß√£o ao usu√°rio autenticado
  - [x] Retornar refei√ß√£o criada

- [ x ] RF04: Editar uma refei√ß√£o (PUT /meals/:id)
  - [ x ] Permitir alterar: nome, descri√ß√£o, data/hora, is_on_diet
  - [ x ] Verificar se refei√ß√£o pertence ao usu√°rio
  - [x ] Retornar erro 404 se n√£o encontrada
  - [ ] Retornar erro 403 se n√£o autorizado

- [ x ] RF05: Apagar uma refei√ß√£o (DELETE /meals/:id)
  - [ ] Verificar se refei√ß√£o pertence ao usu√°rio
  - [ ] Retornar erro 404 se n√£o encontrada
  - [ ] Retornar erro 403 se n√£o autorizado

- [x] RF06: Listar todas as refei√ß√µes do usu√°rio (GET /meals)
  - [x] Retornar apenas refei√ß√µes do usu√°rio autenticado
  - [x] Ordenar por data/hora (mais recente primeiro)

- [ ] RF07: Visualizar uma √∫nica refei√ß√£o (GET /meals/:id)
  - [x  ] Verificar se refei√ß√£o pertence ao usu√°rio
  - [ x ] Retornar erro 404 se n√£o encontrada
  - [ ] Retornar erro 403 se n√£o autorizado

### M√©tricas
- [ ] RF08: Recuperar m√©tricas do usu√°rio (GET /metrics)
  - [ ] Total de refei√ß√µes registradas
  - [ ] Total de refei√ß√µes dentro da dieta
  - [ ] Total de refei√ß√µes fora da dieta
  - [ ] Melhor sequ√™ncia de refei√ß√µes dentro da dieta

## üîí Requisitos N√£o-Funcionais (RNF)

### Seguran√ßa
- [x] RNF01: Autentica√ß√£o via cookies (session_id)
- [x] RNF02: Isolamento de dados por usu√°rio
- [ ] RNF03: Valida√ß√£o de propriedade dos recursos (refei√ß√µes)
- [x] RNF04: Email √∫nico por usu√°rio

### Performance
- [ ] RNF05: Usar √≠ndices no banco (session_id, user_id)
- [ ] RNF06: Consultas otimizadas para m√©tricas

### Valida√ß√£o
- [ ] RNF07: Validar schemas de entrada com Zod ou similar
- [ ] RNF08: Retornar erros padronizados (400, 401, 403, 404)
- [ ] RNF09: Validar formato de UUID
- [ ] RNF10: Validar formato de email

### C√≥digo
- [x] RNF11: Organizar c√≥digo em rotas separadas
- [x] RNF12: Criar middlewares reutiliz√°veis
- [x] RNF13: Tipagem completa com TypeScript
- [ ] RNF14: Tratamento de erros centralizado

## üéØ Pr√≥ximos Passos Sugeridos

### üî• PRIORIDADE ALTA (Come√ßar por aqui)
1. [x] Criar schemas de valida√ß√£o com Zod
   - [x] Schema para criar usu√°rio (CreateUserSchema)
   - [x] Schema para criar refei√ß√£o (CreateMealSchema)
   - [ x  ] Schema para atualizar refei√ß√£o (UpdateMealSchema)
   - [ ] Schema para par√¢metros de rota (IdParamSchema)

2. [x] Implementar rotas de usu√°rios (src/routes/users.ts)
   - [x] POST /users - Criar usu√°rio
   - [x] Gerar session_id e configurar cookie

3. [x] Criar middleware de autentica√ß√£o
   - [x] Verificar session_id nos cookies
   - [x] Buscar usu√°rio no banco
   - [x] Adicionar user_id ao request

4. [ ] Implementar CRUD de refei√ß√µes (src/routes/meals.ts)
   - [ ] POST /meals - Criar refei√ß√£o
   - [ ] GET /meals - Listar refei√ß√µes do usu√°rio
   - [ ] GET /meals/:id - Buscar uma refei√ß√£o
   - [ ] PUT /meals/:id - Atualizar refei√ß√£o
   - [ ] DELETE /meals/:id - Deletar refei√ß√£o

5. [ ] Implementar rota de m√©tricas (src/routes/metrics.ts)
   - [ ] GET /metrics - Retornar estat√≠sticas do usu√°rio

### üîß MELHORIAS
6. [x] Adicionar @fastify/cookie para gerenciar cookies
7. [ ] Adicionar tratamento de erros global
8. [ ] Testar todas as rotas manualmente
9. [ ] Documentar API (opcional: Swagger)

## üìù Regras de Neg√≥cio

- ‚úÖ As refei√ß√µes devem ser relacionadas a um usu√°rio (FK implementada)
- ‚ö†Ô∏è  O usu√°rio s√≥ pode visualizar, editar e apagar as refei√ß√µes que ele criou (precisa implementar verifica√ß√£o)
- ‚ö†Ô∏è  Usu√°rio deve ser identificado entre requisi√ß√µes (precisa implementar cookies/middleware)

