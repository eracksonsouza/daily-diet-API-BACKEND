# Daily Diet API - TODO List

## ‚úÖ Feito

### Infraestrutura
- [x] Configurar Fastify
- [x] Configurar Knex com SQLite
- [x] Criar migra√ß√£o para tabela de usu√°rios
- [x] Criar migra√ß√£o para tabela de refei√ß√µes
- [x] Configurar TypeScript
- [x] Configurar scripts de desenvolvimento

### Modelo de Dados
- [x] Tabela users com (id, name, email, session_id, created_at)
- [x] Tabela meals com (id, user_id, name, description, date_time, is_on_diet, created_at)
- [x] Relacionamento entre users e meals (CASCADE)

## üìã Requisitos Funcionais (RF)

### Usu√°rios
- [ ] RF01: Criar um novo usu√°rio (POST /users)
  - [ ] Validar dados de entrada (nome, email)
  - [ ] Gerar UUID √∫nico
  - [ ] Gerar session_id para cookies
  - [ ] Retornar dados do usu√°rio criado

- [ ] RF02: Identificar usu√°rio entre requisi√ß√µes
  - [ ] Implementar middleware de autentica√ß√£o via cookies
  - [ ] Validar session_id em cada requisi√ß√£o protegida
  - [ ] Retornar erro 401 se n√£o autenticado

### Refei√ß√µes
- [ ] RF03: Registrar uma refei√ß√£o (POST /meals)
  - [ ] Validar dados: nome, descri√ß√£o, data/hora, is_on_diet
  - [ ] Associar refei√ß√£o ao usu√°rio autenticado
  - [ ] Retornar refei√ß√£o criada

- [ ] RF04: Editar uma refei√ß√£o (PUT /meals/:id)
  - [ ] Permitir alterar: nome, descri√ß√£o, data/hora, is_on_diet
  - [ ] Verificar se refei√ß√£o pertence ao usu√°rio
  - [ ] Retornar erro 404 se n√£o encontrada
  - [ ] Retornar erro 403 se n√£o autorizado

- [ ] RF05: Apagar uma refei√ß√£o (DELETE /meals/:id)
  - [ ] Verificar se refei√ß√£o pertence ao usu√°rio
  - [ ] Retornar erro 404 se n√£o encontrada
  - [ ] Retornar erro 403 se n√£o autorizado

- [ ] RF06: Listar todas as refei√ß√µes do usu√°rio (GET /meals)
  - [ ] Retornar apenas refei√ß√µes do usu√°rio autenticado
  - [ ] Ordenar por data/hora (mais recente primeiro)

- [ ] RF07: Visualizar uma √∫nica refei√ß√£o (GET /meals/:id)
  - [ ] Verificar se refei√ß√£o pertence ao usu√°rio
  - [ ] Retornar erro 404 se n√£o encontrada
  - [ ] Retornar erro 403 se n√£o autorizado

### M√©tricas
- [ ] RF08: Recuperar m√©tricas do usu√°rio (GET /metrics)
  - [ ] Total de refei√ß√µes registradas
  - [ ] Total de refei√ß√µes dentro da dieta
  - [ ] Total de refei√ß√µes fora da dieta
  - [ ] Melhor sequ√™ncia de refei√ß√µes dentro da dieta

## üîí Requisitos N√£o-Funcionais (RNF)

### Seguran√ßa
- [ ] RNF01: Autentica√ß√£o via cookies (session_id)
- [ ] RNF02: Isolamento de dados por usu√°rio
- [ ] RNF03: Valida√ß√£o de propriedade dos recursos (refei√ß√µes)
- [ ] RNF04: Email √∫nico por usu√°rio

### Performance
- [ ] RNF05: Usar √≠ndices no banco (session_id, user_id)
- [ ] RNF06: Consultas otimizadas para m√©tricas

### Valida√ß√£o
- [ ] RNF07: Validar schemas de entrada com Zod ou similar
- [ ] RNF08: Retornar erros padronizados (400, 401, 403, 404)
- [ ] RNF09: Validar formato de UUID
- [ ] RNF10: Validar formato de email

### C√≥digo
- [ ] RNF11: Organizar c√≥digo em rotas separadas
- [ ] RNF12: Criar middlewares reutiliz√°veis
- [ ] RNF13: Tipagem completa com TypeScript
- [ ] RNF14: Tratamento de erros centralizado

## üéØ Pr√≥ximos Passos Sugeridos

1. [ ] Implementar valida√ß√£o com Zod
2. [ ] Criar middleware de autentica√ß√£o
3. [ ] Implementar rotas de usu√°rios
4. [ ] Implementar rotas de refei√ß√µes (CRUD)
5. [ ] Implementar rota de m√©tricas
6. [ ] Adicionar tratamento de erros
7. [ ] Testar todas as rotas
8. [ ] Documentar API (opcional: Swagger)

## üìù Regras de Neg√≥cio

- ‚úÖ As refei√ß√µes devem ser relacionadas a um usu√°rio (FK implementada)
- ‚ö†Ô∏è  O usu√°rio s√≥ pode visualizar, editar e apagar as refei√ß√µes que ele criou (precisa implementar verifica√ß√£o)
- ‚ö†Ô∏è  Usu√°rio deve ser identificado entre requisi√ß√µes (precisa implementar cookies/middleware)

